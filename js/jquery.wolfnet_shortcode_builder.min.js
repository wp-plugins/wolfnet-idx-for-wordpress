"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});
(function(e){e.widget("ui.wolfnetShortcodeBuilder",e.ui.dialog,{options:{autoOpen:false,height:450,width:475,modal:true,defaultTitle:"WolfNet Shortcode Builder",elmPrefix:"wolfnetShortcodeBuilder_",rootUri:"",loaderUri:"",loaderId:"loaderImage",menuId:"menuPage",pageSuffix:"_page",menuItems:{featuredListings:{buttonLabel:"Add Featured Listings",shortcode:"wnt_featured",pageTitle:"Featured Listing Shortcode",uri:"-options-featured"},listingGrid:{buttonLabel:"Add Listing Grid",shortcode:"wnt_grid",
pageTitle:"Listing Grid Shortcode",uri:"-options-grid"},propertyList:{buttonLabel:"Add Property List",shortcode:"wnt_list",pageTitle:"Property List Shortcode",uri:"-options-list"},quickSearch:{buttonLabel:"Add QuickSearch",shortcode:"wnt_search",pageTitle:"QuickSearch Shortcode",uri:"-options-quicksearch"}}},shortcode:"",_create:function(){var a=this.options;this._createLoaderImage();this._createMenuPage();this._establishEvents();this._activePage=a.menuId;a.title=a.defaultTitle;e.ui.dialog.prototype._create.call(this)},
_establishEvents:function(){var a=this;e(this.element).bind("insertShortcodeEvent",function(){a.insertShortcode();a.close()})},_createMenuPage:function(){var a=this,c=this.options,b=this.element,d=e(b),f=c.elmPrefix+c.menuId+c.pageSuffix,b=b.find("#"+f),c=c.menuItems,g=null;if(b.length==0){b=e("<div/>");b.attr("id",f);for(var h in c){g=e("<button/>");g.html(c[h].buttonLabel);g.addClass("pageButton");g.appendTo(b);g[0].pageId=h;g.click(function(){a.openPage(this.pageId)})}b.appendTo(d)}},_createLoaderImage:function(){var a=
this.options,c=this.element,b=a.elmPrefix+a.loaderId,d=e("#"+b);if(d.length==0){d=e("<div/>");d.append(e('<img src="'+a.loaderUri+'" />'));d.attr("id",b);d.addClass("wolfnet_loaderImage");d.hide();d.appendTo(c)}this.loaderImage=d},_createPage:function(a){var c=this,b=this.options,d=e(this.element),f=c.loaderImage,g=null,h=null;if("uri"in b.menuItems[a]&&b.menuItems[a].uri!=""){var i=b.rootUri+b.menuItems[a].uri;$page=e("<div/>");$page.attr("id",b.elmPrefix+a+b.pageSuffix);$page.attr("class",(b.elmPrefix+
b.pageSuffix).replace("__","_"));$page.appendTo(d);g=e("<button/>");g.html("Back");g.appendTo($page);g.click(function(){c.closePage()});e.ajax({type:"GET",dataType:"html",url:i,cache:false,beforeSend:function(){$page.hide();f.show()},success:function(b){$page.append(b);wolfnet.initMoreInfo($page.find(".wolfnet_moreInfo"));f.hide();$page.show();h=e("<button/>");h.html("Insert Shortcode");h.appendTo($page);h.click(function(){c._buildShortcode(a)})}})}},_getPage:function(a){var c=this.options;return e("#"+
(c.elmPrefix+a+c.pageSuffix))},openPage:function(a){var c=this.options;e(this.element);var b=this._getPage(this._activePage);if(a!=this._activePage){var d=this._getPage(a);this._activePage=a;b.hide();a in c.menuItems&&"pageTitle"in c.menuItems[a]?this._setOption("title",c.defaultTitle+": "+c.menuItems[a].pageTitle):this._setOption("title",c.defaultTitle);if(d.length==0){this._createPage(a);this._getPage(a)}else d.show()}},closePage:function(){this.openPage(this.options.menuId)},_buildShortcode:function(a){var c=
this,b=c.options,d=c._getPage(a),f={},g="["+b.menuItems[a].shortcode+" /]",h=["mode","savedsearch","criteria"],a=d.find('input[type="radio"][name="mode"][value="advanced"]:first:checked'),i=d.find('select[name="savedsearch"]:first'),j=c.loaderImage;j.show();d.find("input, select").each(function(){if(this.name!=""&&e.inArray(this.name,h)==-1)switch(this.type){default:this.value.trim()!=""&&(f[this.name]=this.value.trim());break;case "checkbox":case "radio":if(this.checked==true)f[this.name]=this.value}});
if(a.length!=0&&i.length!=0){delete f.zipcode;delete f.city;delete f.minprice;delete f.maxprice;e.ajax({url:b.rootUri+"-saved-search",type:"GET",dataType:"json",data:{ID:i.val()},success:function(a){for(var b in a)f[b]=a[b];c._buildShortcodeString(f,g)},complete:function(){j.hide()}})}else{c._buildShortcodeString(f,g);j.hide()}},_buildShortcodeString:function(a,c){var b=e(this.element),d=c,f;for(f in a)d=d.replace("/]"," "+f+'="'+a[f]+'" /]');this.shortcode=d;b.trigger("insertShortcodeEvent")},insertShortcode:function(){this.options.tinymce.execCommand("mceInsertContent",
false,this.shortcode)}})})(jQuery);
